# agent can traverse over the generated_data.json
#  which looks like this
"""
{
    "id": 0,
    "material": "Copper",
    "usage": "Electrical wiring in microgrids, transformers, and renewable energy systems",
    "supplier": "Aurora Conductors Ltd.",
    "supplier_contact": {
      "name": "Jane Smith",
      "email": "jane.smith@auroraconductors.com",
      "position": "Sales Manager"
    },
    "insights": [
      "**Insight 1: Copper Supply Chain Disruption in Chile**\n\nA recent severe drought in Chile, which is the world's largest copper producer, has led to a significant reduction in copper production, with estimates suggesting a 10% decline in output for the year. This supply chain disruption is expected to put upward pressure on copper prices, potentially impacting the global demand for renewable energy technologies and electric vehicles that rely heavily on copper.",
      "**Insight 2: Copper Production Impacted by Increased Tensions in the Middle East**\n\nRising tensions between Iran and Saudi Arabia have led to a surge in global oil prices, causing a diversion of copper imports from the Middle East to other regions, resulting in a 5% increase in copper imports to the United States from countries such as Canada and Peru. This shift in copper supply chains is expected to alleviate some of the pressure on the global copper market, but may also lead to increased costs for copper producers in the affected regions.",
      "**Insight 3: Copper Production Disrupted by Floods in the Democratic Republic of Congo**\n\nHeavy rainfall and subsequent flooding in the Democratic Republic of Congo, which is home to significant copper deposits, have caused widespread damage to mining infrastructure and disrupted copper production, resulting in a 7% reduction in the country's copper output for the quarter. This supply chain disruption is expected to further exacerbate the already tight global copper market, potentially leading to increased prices and supply chain volatility."
    ],
    "article": "**Copper Supply Chain Disruptions: Implications for Renewable Energy and Electric Vehicles**\n\nThe global copper market is facing unprecedented challenges due to a series of supply chain disruptions in key producing regions. Recent droughts in Chile, increased tensions in the Middle East, and floods in the Democratic Republic of Congo have resulted in a significant reduction in copper production, exacerbating the already tight global copper market. This article synthesizes the recent insights into a coherent narrative, analyzes the potential impact on supply chains and pricing, discusses possible mitigation strategies, and considers the broader implications for sustainable energy projects.\n\n**Supply Chain Disruptions and Pricing Implications**\n\nThe severe drought in Chile, the world's largest copper producer, is expected to lead to a 10% decline in copper output for the year. This reduction in supply will put upward pressure on copper prices, potentially impacting the global demand for renewable energy technologies and electric vehicles that rely heavily on copper. The diversion of copper imports from the Middle East to other regions, resulting from increased tensions between Iran and Saudi Arabia, may alleviate some of the pressure on the global copper market. However, the 5% increase in copper imports to the United States from countries such as Canada and Peru may lead to increased costs for copper producers in the affected regions. The heavy rainfall and subsequent flooding in the Democratic Republic of Congo have caused a 7% reduction in the country's copper output for the quarter, further exacerbating the tight global copper market.\n\nThe cumulative effect of these supply chain disruptions is likely to lead to increased copper prices, potentially disrupting the global demand for renewable energy technologies and electric vehicles. As a result, industry professionals and decision-makers must consider the potential implications for their supply chains and pricing strategies.\n\n**Mitigation Strategies and Alternative Materials**\n\nOne possible mitigation strategy is to explore the use of alternative materials, such as aluminium, in electrical wiring, transformers, and renewable energy systems. Aluminium has similar electrical conductivity to copper but is often less expensive and more abundant. However, aluminium has a lower melting point and higher reactivity, which may require additional processing and safety measures. Another strategy is to diversify copper supply chains by sourcing from multiple regions and suppliers, reducing dependence on any one country or supplier.\n\n**Broader Implications for Sustainable Energy Projects**\n\nThe copper supply chain disruptions have significant implications for sustainable energy projects, particularly those reliant on renewable energy technologies and electric vehicles. Increased copper prices may lead to higher costs for project developers, potentially delaying or canceling projects. However, the use of alternative materials, such as aluminium, may provide a viable solution for mitigating the impact of copper supply chain disruptions. Furthermore, the increased focus on supply chain resilience and diversification may lead to more robust and sustainable energy supply chains, better equipped to withstand future disruptions.\n\nIn conclusion, the recent copper supply chain disruptions have significant implications for the global copper market, renewable energy technologies, and electric vehicles. Industry professionals and decision-makers must consider the potential impact on supply chains and pricing strategies, exploring mitigation strategies such as the use of alternative materials and diversifying copper supply chains. By doing so, they can ensure the continued delivery of sustainable energy projects and mitigate the risks associated with copper supply chain disruptions.",
    "contract_clauses": "**CONTRACT FOR THE SUPPLY OF COPPER**\n\nThis Contract is entered into on [DATE] (\"Effective Date\") by and between:\n\n**Aurora Conductors Ltd.** (\"Supplier\") with its principal place of business at [ADDRESS], and\n\n**[Buyer's Name]** (\"Buyer\") with its principal place of business at [ADDRESS].\n\n**ARTICLE 1: PRICE VOLATILITY AND CONTRACT RENEGOTIATION**\n\n1.1 The Supplier shall notify the Buyer in writing of any change in the market price of Copper that exceeds 15% of the agreed-upon price per metric tonne, as specified in Schedule 1 of this Contract.\n\n1.2 Upon receipt of such notice, the Buyer and the Supplier shall meet within 30 days to renegotiate the price of Copper in accordance with this Contract.\n\n1.3 If the parties are unable to agree on a revised price within 60 days of the initial notice, the Buyer may terminate this Contract upon written notice to the Supplier.\n\n**ARTICLE 2: FORCE MAJEURE CONDITIONS**\n\n2.1 \"Force Majeure\" means any of the following events that prevent or hinder the performance of this Contract:\n\n(a) Natural disasters, including but not limited to earthquakes, floods, droughts, and storms;\n\n(b) Governmental actions, including but not limited to, embargoes, sanctions, and trade restrictions;\n\n(c) Wars, conflicts, and acts of terrorism;\n\n(d) Strikes, lockouts, and labor disputes;\n\n(e) Supply chain disruptions caused by severe weather conditions, mining accidents, or other unforeseen events that result in a 10% or greater reduction in global Copper production.\n\n2.2 In the event of a Force Majeure, the Supplier shall notify the Buyer in writing within 5 days of the occurrence of such event.\n\n2.3 The Supplier shall make reasonable efforts to mitigate the effects of the Force Majeure and resume performance of this Contract as soon as practicable.\n\n**ARTICLE 3: SUSTAINABILITY AND ENVIRONMENTAL COMPLIANCE**\n\n3.1 The Supplier shall ensure that its production and supply of Copper comply with all applicable laws, regulations, and industry standards related to sustainability and environmental protection.\n\n3.2 The Supplier shall maintain a robust sustainability and environmental management system, including but not limited to:\n\n(a) Compliance with the International Organization for Standardization (ISO) 26000 standard for social responsibility;\n\n(b) Adherence to the International Cyanide Management Code (ICMC) for the responsible use of cyanide in the mining industry;\n\n(c) Implementation of a waste management plan that meets or exceeds the standards set forth in the European Union's Waste Framework Directive (2008/98/EC);\n\n(d) Regular monitoring and reporting of environmental performance metrics, including but not limited to, greenhouse gas emissions, water usage, and waste generation.\n\n3.3 The Supplier shall provide the Buyer with annual reports on its sustainability and environmental performance, which shall include but not be limited to:\n\n(a) A description of the Supplier's sustainability and environmental management system;\n\n(b) A summary of the Supplier's environmental performance metrics;\n\n(c) A list of any environmental incidents or non-compliances that have occurred during the reporting period.\n\n**ARTICLE 4: DEFAULT AND TERMINATION**\n\n4.1 If the Supplier fails to comply with any of the provisions of this Contract, including but not limited to, the sustainability and environmental compliance requirements set forth in Article 3, the Buyer may terminate this Contract upon written notice to the Supplier.\n\n4.2 Upon termination of this Contract, the Buyer shall be entitled to damages, including but not limited to, the cost of procuring Copper from alternative suppliers, in an amount equal to 20% of the total contract value.\n\nIN WITNESS WHEREOF, the parties have executed this Contract as of the date first above written.\n\n---\n\n**SCHEDULE 1: PRICE AND QUANTITY**\n\n* Price: $8,500 per metric tonne\n* Quantity: 10,000 metric tonnes per annum\n* Delivery terms: FOB (Free on Board) at the Supplier's facility in Chile\n\n---\n\n**ACKNOWLEDGMENT**\n\nBy signing below, the parties acknowledge that they have read, understand, and agree to be bound by the terms and conditions of this Contract.\n\n---\n\n**SUPPLIER**\n\nSignature: ______________________________\nDate: __________________________________\n\n**BUYER**\n\nSignature: ______________________________\nDate: __________________________________",
    "alternate_materials": [
      {
        "material": "Aluminium",
        "supplier": "AlumaTech Solutions",
        "supplier_contact": {
          "name": "John Doe",
          "email": "john.doe@alumatech.com",
          "position": "Account Executive"
        }
      }
    ]
"""
# idea is it would read the insights and conclude to do something based on this and looking at the contract conclude that it might be possible to contact the supplier & end things with them  + move onto the alternate material . agent should produce the reasoning behind recommended action

import json
import os
from openai import AsyncOpenAI
import asyncio
from dotenv import load_dotenv

# Load env file
load_dotenv()

# Initialize the AsyncOpenAI client
client = AsyncOpenAI(
    base_url="https://api.groq.com/openai/v1",
    api_key=os.environ.get("GROQ_API_KEY")
)

MODEL = "llama-3.1-70b-versatile"

async def analyze_situation(data_entry):
    # Format the insights and contract info into a prompt
    insights_text = "\n".join([f"- {insight}" for insight in data_entry["insights"]])
    
    prompt = f"""
    Project Context:
    Project LLaMA is implementing a low-carbon grid adaptation leveraging renewable energy and storage solutions for regional energy transformation. Material supply chain reliability is critical for project success.
    
    Material: {data_entry["material"]}
    Usage: {data_entry["usage"]}
    Current Supplier: {data_entry["supplier"]}
    
    Recent Market Insights:
    {insights_text}
    
    Contract Terms Summary:
    - Price volatility threshold: 15% change triggers renegotiation
    - Force majeure includes supply disruptions causing 10%+ reduction in production
    - Contract can be terminated if price negotiations fail after 60 days
    
    Alternative Material Available:
    - Material: {data_entry["alternate_materials"][0]["material"]}
    - Supplier: {data_entry["alternate_materials"][0]["supplier"]}
    
    Based on these insights and contract terms, analyze:
    1. Do current market conditions meet the contract thresholds for renegotiation or force majeure?
    2. What are the key risks and impacts to our supply chain and Project LLaMA's renewable energy goals?
    3. What are our contractual options and their implications for maintaining reliable material supply for the project?
    
    Core objective is always to protect the project from unexpected cost rises or delays and you are acting with that goal in mind.

    Provide your analysis in a clear, structured format focusing just on the current situation and its impact on Project LLaMA's objectives.
    """

    analysis_completion = await client.chat.completions.create(
        messages=[
            {
                "role": "system", 
                "content": "You are an expert supply chain analyst specializing in renewable energy projects. Analyze the situation objectively and identify key issues and contractual implications that could impact low-carbon grid implementation."
            },
            {
                "role": "user",
                "content": prompt
            }
        ],
        model=MODEL,
        temperature=0.4,
        max_tokens=1000
    )

    return analysis_completion.choices[0].message.content

async def analyze_alternative(data_entry, current_analysis):
    # Extract insights for both materials
    primary_insights_text = "\n".join([f"- {insight}" for insight in data_entry["insights"]])
    alt_material_data = data_entry["alternate_materials"][0]
    alt_insights_text = "\n".join([f"- {insight}" for insight in alt_material_data["insights"]])
    
    prompt = f"""
    Project Context:
    Project LLaMA is evaluating alternative materials to mitigate supply chain risks while maintaining its low-carbon grid adaptation goals.
    
    Current Situation Analysis:
    {current_analysis}
    
    Primary Material Analysis:
    - Material: {data_entry["material"]}
    - Current Usage: {data_entry["usage"]}
    - Current Supplier: {data_entry["supplier"]}
    
    Recent Market Insights for {data_entry["material"]}:
    {primary_insights_text}
    
    Alternative Material Analysis:
    - Material: {alt_material_data["material"]}
    - Potential Supplier: {alt_material_data["supplier"]}
    
    Recent Market Insights for {alt_material_data["material"]}:
    {alt_insights_text}
    
    Given the current situation analysis and market insights for both materials:
    1. What are the compelling reasons to consider switching from {data_entry["material"]} to {alt_material_data["material"]}?
    2. How does the alternative material's market stability compare to the current material?
    3. What are the key advantages and risks of switching to this alternative?
    4. What is the feasibility of establishing a supply relationship with {alt_material_data["supplier"]}?
    5. How would switching to this alternative impact Project LLaMA's:
       - Supply chain resilience
       - Cost structure
       - Sustainability goals
       - Technical performance
    
    Provide your analysis in a clear, structured format with specific recommendations on whether Project LLaMA should consider switching materials.
    """

    alternative_analysis = await client.chat.completions.create(
        messages=[
            {
                "role": "system", 
                "content": "You are an expert materials analyst specializing in renewable energy projects. Compare materials objectively, considering market conditions, technical requirements, and commercial implications for low-carbon grid implementation. Focus on providing actionable recommendations."
            },
            {
                "role": "user",
                "content": prompt
            }
        ],
        model=MODEL,
        temperature=0.4,
        max_tokens=1000
    )

    return alternative_analysis.choices[0].message.content


async def main():
    # Load the generated data
    with open("generated_data.json", "r") as f:
        data = json.load(f)
    
    # Analyze each entry
    for entry in data:
        print(f"\nAnalyzing situation for {entry['material']}...")
        analysis = await analyze_situation(entry)
        print("\nSituation Analysis:")
        # print(analysis)
        
        print(f"\nAnalyzing alternative materials for {entry['material']}...")
        alt_analysis = await analyze_alternative(entry, analysis)
        print("\nAlternative Materials Analysis:")
        print(alt_analysis)
        
        print("\n" + "="*80 + "\n")

if __name__ == "__main__":
    asyncio.run(main())
